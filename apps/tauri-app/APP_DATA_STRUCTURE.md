# 应用数据目录结构设计

## 概述

本文档详细说明了小说阅读器应用的数据目录结构设计。应用使用操作系统的标准应用数据目录来存储所有用户数据和应用数据，确保数据的安全性和可维护性。

在 Windows 系统上，应用数据通常存储在：
```
%APPDATA%\com.yangguodong.tauri-app\
```

在 macOS 上，存储在：
```
~/Library/Application Support/com.yangguodong.tauri-app/
```

在 Linux 上，存储在：
```
~/.local/share/com.yangguodong.tauri-app/
```

## 目录结构

应用数据目录包含以下子目录：

```
com.yangguodong.tauri-app/
├── documents/           # 用户上传的本地小说文件
├── cache/              # 缓存数据
│   ├── thumbnails/     # 书籍封面缩略图
│   ├── chapters/       # 章节内容缓存
│   └── metadata/       # 书籍元数据缓存
├── logs/               # 日志文件
│   ├── error.log       # 错误日志
│   ├── app.log         # 应用日志
│   └── performance.log # 性能日志
├── settings/           # 用户设置和配置
│   ├── user_prefs.json # 用户偏好设置
│   └── reading_history.json # 阅读历史记录
├── downloads/          # 从在线书城下载的书籍
│   ├── temp/          # 下载过程中的临时文件
│   └── completed/     # 已完成下载的书籍
├── temp/               # 临时文件
└── backups/            # 备份数据
    ├── settings/      # 设置备份
    └── reading_progress/ # 阅读进度备份
```

## 各目录详细说明

### 1. documents/ - 用户文档目录
- **用途**：存储用户上传的本地小说文件
- **文件类型**：.txt, .epub, .pdf 等支持的格式
- **管理策略**：用户可直接管理，应用启动时扫描此目录以构建书架

### 2. cache/ - 缓存目录
- **用途**：存储应用运行时的缓存数据，可安全删除
- **子目录**：
  - `thumbnails/`：书籍封面图片缩略图
  - `chapters/`：解析后的章节内容缓存
  - `metadata/`：书籍元数据（作者、简介等）缓存
- **管理策略**：定期清理过期缓存，应用启动时可重建

### 3. logs/ - 日志目录
- **用途**：存储应用运行日志，用于调试和问题追踪
- **文件类型**：.log
- **文件说明**：
  - `error.log`：记录错误和异常信息
  - `app.log`：记录常规应用操作日志
  - `performance.log`：记录性能相关日志
- **管理策略**：按日期轮转，保留最近30天的日志

### 4. settings/ - 设置目录
- **用途**：存储用户个性化设置和应用配置
- **文件类型**：.json
- **文件说明**：
  - `user_prefs.json`：用户界面偏好（主题、字体大小等）
  - `reading_history.json`：阅读历史记录和进度
- **管理策略**：自动保存，用户可导出/导入

### 5. downloads/ - 下载目录
- **用途**：存储从在线书城下载的书籍
- **子目录**：
  - `temp/`：下载过程中的临时文件
  - `completed/`：已完成下载的书籍
- **管理策略**：下载完成后移动文件到documents目录或保持独立

### 6. temp/ - 临时目录
- **用途**：存储应用运行时的临时文件
- **管理策略**：应用启动时清空，关闭时清理

### 7. backups/ - 备份目录
- **用途**：存储重要数据的备份
- **子目录**：
  - `settings/`：用户设置备份
  - `reading_progress/`：阅读进度备份
- **管理策略**：定期自动备份，用户可手动恢复

## 数据管理策略

### 数据持久性
- **持久数据**：documents, settings, backups 目录中的数据需要持久保存
- **可再生数据**：cache, temp 目录中的数据可以随时重新生成
- **日志数据**：logs 目录中的数据按策略保留

### 安全性考虑
- 所有用户数据都存储在应用数据目录中，不访问系统其他位置
- 敏感信息（如用户设置）不以明文形式存储
- 文件读写操作都进行错误处理和权限检查

### 性能优化
- 缓存机制减少重复解析和处理
- 异步文件操作避免阻塞UI
- 定期清理过期数据释放存储空间

## 扩展性设计

此目录结构设计具有良好的扩展性，可以方便地添加新的数据类型：

1. **新增功能模块**：只需在根目录下添加新的子目录
2. **版本升级兼容**：新版本可自动迁移旧版本数据结构
3. **跨平台兼容**：使用Tauri提供的路径API确保跨平台兼容性

## 备份与恢复

建议用户定期备份以下目录：
- `documents/`：个人收藏的书籍
- `settings/`：个性化设置
- `backups/`：自动备份数据

## 清理策略

应用提供以下清理选项：
1. **清理缓存**：删除cache目录内容
2. **清理日志**：删除30天前的日志文件
3. **清理临时文件**：删除temp目录内容
4. **深度清理**：清理所有可再生数据